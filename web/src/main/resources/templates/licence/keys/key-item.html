<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head th:replace="fragments/header :: common"/>
    <body>
        <nav th:replace="fragments/navbar :: navbar"/>

        <div class="container-fluid pt-2">
            <nav th:replace="fragments/navbar :: breadcrumb"/>

            <div class="row" th:include="fragments/item :: title(entity = ${entity}, name = 'Ключ СЛК')"></div>

            <form action="#" th:action="@{${url}+'/submit'}" th:object="${entity}" method="post">
                <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>

                <div>
                    <button th:replace="fragments/item :: operation-save"/>
                    <button th:replace="fragments/item :: operation-delete(url = ${url})"/>

                    <button id="btn_upload" class="btn btn-outline-info" type="button" onclick="uploadFile()">
                        <i class="fas fa-upload" aria-hidden="true"></i>  Загрузить файл
                    </button>

                    <button th:replace="fragments/item :: operation-close(url = ${url})"/>

                    <div style="margin-bottom: 10px"/>
                </div>

                <field th:replace="fragments/fields :: id"></field>
                <field th:replace="fragments/fields :: name"></field>
                <field th:replace="fragments/fields :: comment"></field>
                <field th:replace="fragments/fields :: filename(readOnly='true')"></field>
                <field th:replace="fragments/fields :: filesize(readOnly='true')"></field>
            </form>
        </div>
        <footer th:replace="fragments/footer :: bootstrap"/>


        <div id="modalUploadFile" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <form action="#" th:action="@{${url}+'/uploadFile'}" method="post" enctype="multipart/form-data">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Загрузка файла</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <input name="id" type="text" th:field="*{entity.id}" hidden="true"/>

                        <div class="modal-body">
                            <div class="form-group">
                                <div class="mb-3">
                                    <label for="input-upload-file" class="form-label">Выберите cryptkey-файл</label>
                                    <input name="file" type="file" class="form-control" id="input-upload-file" accept=".cryptkey"/>
                                </div>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary" value="upload">ОК</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="cancelUploadFile()">Отмена</button>
                        </div>
                    </div>

                    <script>
                        function cancelUploadFile() {
                            $('#input-upload-file').val(null);
                        }
                    </script>
                </form>
            </div>
        </div>

        <script th:inline="javascript">
            if ([[${entity.id}]] == null) {
                $('#btn_upload').hide();
            }
        </script>

        <script>
            function uploadFile() {
                $('#modalUploadFile').modal();
            }
        </script>
    </body>
</html>